#Python Lib
import time
from threading import Thread
from random import randint

#Current Module
from . import set_hitbox_bullet
from . import DefaultBullet

class   LambsInvocation(DefaultBullet):

    @classmethod
    def build_class(cls, lamb):
        cls.arrival = cls.env.mod.objects.SpawnLamb.build_class(cls.env, lamb)
        return cls

    def _next_lamb(self):
        self.will_summon = randint(self.mi, self.ma)

    def __init__(self, weapon, gargamel):
        self.alive = True
        self.weapon = weapon
        self.gargamel = gargamel
        self.mi = 22
        self.ma = 44
        self._next_lamb()

    def display(self, env):
        pass
    
    def spawn(self):
        self.tick = self.env.mod.tools.Tick()
        while True:
            if not self.will_summon:
                monster = self.lamb(self.x, self.y)
                t = Thread(target=monster.move, args=())
                t.daemon = True
                self.env.monsters.append(monster)
                t.start()
                self._next_lamb()
            if not self.weapon.in_hand:
                return self.dead()
            if not self.gargamel.lives:
                return self._dead()
            self.will_summon -= 1
            if self._quit():
                return
